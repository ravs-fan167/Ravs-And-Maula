<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel - Ravs Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;} .card{background:rgba(255,255,255,0.95);}</style>
</head>
<body class="bg-gradient-to-br from-sky-600 to-cyan-400 min-h-screen text-gray-900">
<div class="max-w-6xl mx-auto p-6">

<header class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-4xl font-bold text-white">Ravs Store Hosting</h1>
    <p class="text-sm text-white/90">VPS ‚Ä¢ RDP ‚Ä¢ Jasa Jaringan ‚Ä¢ Dev SA:MP</p>
  </div>
  <div class="flex gap-2 items-center">
    <!-- three control boxes -->
    <div class="flex gap-2">
      <div class="box-control cursor-pointer p-3 bg-white rounded" data-action="toggle-sidebar" title="Dashboard">‚ò∞</div>
      <div class="box-control cursor-pointer p-3 bg-white rounded" data-action="open-login" title="Login Email">üîí</div>
      <div class="box-control cursor-pointer p-3 bg-white rounded" data-action="open-settings" title="Settings">‚öôÔ∏è</div>
    </div>
  </div>
</header>

<main>
<h2 class="text-2xl font-bold text-white mb-4">Admin Panel</h2>
<div class="card p-6 rounded-xl shadow">
  <div class="mb-4">
    <label class="text-sm">Masuk sebagai admin (masukkan email admin)</label>
    <input id="adminEmail" class="w-full p-2 border rounded mt-1 bg-white" placeholder="admin@domain.com" />
    <div class="mt-2 flex gap-2">
      <button id="loginBtn" class="px-4 py-2 rounded bg-white text-sky-600">Login</button>
      <button id="logoutBtn" class="px-4 py-2 rounded border">Logout</button>
    </div>
    <div id="loginInfo" class="text-sm text-gray-700 mt-2"></div>
  </div>

  <div class="md:flex gap-4">
    <div class="md:w-1/3" id="ordersCol">
      <h3 class="font-semibold">Daftar Pesanan</h3>
      <div id="ordersList" class="mt-3 space-y-2 max-h-[60vh] overflow-auto"></div>
      <div class="mt-3">
        <input id="forceDeleteId" placeholder="ID untuk hapus cepat" class="w-full p-2 border rounded bg-white" />
        <button id="forceDeleteBtn" class="mt-2 px-3 py-2 rounded bg-red-600 text-white w-full">Hapus Order (Admin)</button>
      </div>
    </div>
    <div class="flex-1 bg-white p-4 rounded" id="chatCol">
      <div id="chatArea">Pilih pesanan untuk melihat chat</div>
    </div>
  </div>
</div>
</main>

<footer class="mt-10 text-sm text-white/90">¬© Ravs Store Hosting</footer>

</div>

<aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-white/95 p-6 shadow-lg transform -translate-x-full transition-transform z-40">
  <div class="mb-4"><h3 class="font-bold text-lg">Dashboard</h3></div>
  <nav class="space-y-2">
    <a href="index.html" class="block p-2 rounded hover:bg-gray-100">Home</a>
    <a href="pesanan.html?paket=Hosting" class="block p-2 rounded hover:bg-gray-100">Hosting</a>
    <a href="pesanan.html?paket=VPS" class="block p-2 rounded hover:bg-gray-100">VPS / RDP</a>
    <a href="pesanan.html?paket=Dev%20SA:MP" class="block p-2 rounded hover:bg-gray-100">Jasa Dev</a>
    <a href="pesanan.html?paket=Jasa%20Jaringan" class="block p-2 rounded hover:bg-gray-100">Jasa Jaringan</a>
    <a href="chatroom.html" class="block p-2 rounded hover:bg-gray-100">Chat Room</a>
    <a href="admin.html" class="block p-2 rounded hover:bg-gray-100">Pesanan / Admin</a>
  </nav>
  <div class="mt-6"><button id="closeSidebar" class="px-3 py-2 rounded border">Tutup</button></div>
</aside>

<div id="loginModal" class="fixed inset-0 hidden items-center justify-center bg-black/50 z-50">
  <div class="bg-white p-6 rounded-xl w-full max-w-md">
    <h3 class="font-bold text-lg">Login / Identitas</h3>
    <p class="text-sm text-gray-600">Masukkan nama & email (untuk admin masukkan email admin).</p>
    <form id="loginForm" class="mt-3 space-y-3">
      <input id="loginName" placeholder="Nama" class="w-full p-2 border rounded" required />
      <input id="loginEmail" type="email" placeholder="Email" class="w-full p-2 border rounded" required />
      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeLogin()" class="px-3 py-2 rounded border">Batal</button>
        <button type="submit" class="px-3 py-2 rounded bg-sky-600 text-white">Simpan</button>
      </div>
    </form>
  </div>
</div>

<div id="settingsModal" class="fixed inset-0 hidden items-center justify-center bg-black/50 z-50">
  <div class="bg-white p-6 rounded-xl w-full max-w-md">
    <h3 class="font-bold text-lg">Settings / Hapus Pesanan</h3>
    <p class="text-sm text-gray-600">Masukkan ID pesanan untuk menghapus. Hanya admin yang bisa menghapus.</p>
    <form id="settingsForm" class="mt-3 space-y-3">
      <input id="delOrderId" placeholder="Order ID" class="w-full p-2 border rounded" required />
      <div class="flex justify-between items-center">
        <div class="text-xs text-gray-500">Admin harus login terlebih dahulu.</div>
        <div class="flex gap-2">
          <button type="button" onclick="closeSettings()" class="px-3 py-2 rounded border">Batal</button>
          <button type="submit" class="px-3 py-2 rounded bg-red-600 text-white">Hapus</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
var ADMIN_EMAILS = ['riorefan422@gmail.com','admin2@ravsstore.com'];
function qs(q){return document.querySelector(q);}
function loadOrders(){ return JSON.parse(localStorage.getItem('ravs_orders')||'[]'); }
function saveOrders(a){ localStorage.setItem('ravs_orders', JSON.stringify(a)); }
var me = null;
qs('#loginBtn').addEventListener('click', function(){
  var email = qs('#adminEmail').value.trim();
  if(!email){ alert('Masukkan email'); return; }
  if(ADMIN_EMAILS.indexOf(email) === -1){
    if(!confirm('Email tidak terdaftar pada list admin default. Tetap login sebagai admin?')) return;
  }
  me = {email: email}; qs('#loginInfo').innerText = 'Logged in as: ' + email;
  renderOrders();
});
qs('#logoutBtn').addEventListener('click', function(){ me=null; qs('#loginInfo').innerText=''; qs('#ordersList').innerHTML=''; qs('#chatArea').innerHTML='Pilih pesanan untuk melihat chat'; });

function renderOrders(){ var list = qs('#ordersList'); list.innerHTML=''; var arr = loadOrders(); if(arr.length===0){ list.innerHTML='<div class="text-sm text-gray-500">Belum ada pesanan.</div>'; return; } arr.sort(function(a,b){ return new Date(b.createdAt)-new Date(a.createdAt); }); arr.forEach(function(o){ var btn = document.createElement('button'); btn.className='w-full text-left p-3 bg-gray-50 rounded mb-2'; btn.innerHTML = '<div class="font-semibold">'+o.package+'</div><div class="text-xs text-gray-500">'+o.name+' ‚Ä¢ '+new Date(o.createdAt).toLocaleString()+'</div><div class="text-sm font-bold mt-1">Rp '+(o.price?o.price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.'):'-')+'</div>'; btn.addEventListener('click', function(){ openChat(o.id); }); list.appendChild(btn); }); }

function openChat(id){ var arr = loadOrders(); var order = arr.find(function(x){ return x.id===id; }); if(!order) return; var chatArea = qs('#chatArea'); chatArea.innerHTML = '<div class="mb-2"><div class="font-bold">'+order.package+' ‚Ä¢ ID: '+order.id+'</div><div class="text-xs text-gray-500">'+order.name+' ‚Ä¢ '+order.email+' ‚Ä¢ WA: '+order.wa+'</div></div><div id="chatBox" class="h-64 overflow-auto border rounded p-3 bg-gray-50 mb-3"></div><form id="replyForm" class="flex gap-2"><input id="replyMsg" class="flex-1 p-2 border rounded" required /><button class="px-4 py-2 rounded bg-white text-sky-600">Kirim</button></form>'; var box = qs('#chatBox'); function renderMsgs(){ box.innerHTML=''; (order.chat||[]).forEach(function(m){ var el=document.createElement('div'); el.className='mb-2'; el.innerHTML = '<div class="text-xs text-gray-500">'+m.from+' ‚Ä¢ '+new Date(m.at).toLocaleString()+'</div><div class="p-2 bg-white rounded">'+m.text+'</div>'; box.appendChild(el); }); box.scrollTop = box.scrollHeight; } renderMsgs(); qs('#replyForm').addEventListener('submit', function(e){ e.preventDefault(); if(!me){ alert('Login sebagai admin dulu'); return; } var txt = qs('#replyMsg').value.trim(); if(!txt) return; order.chat = order.chat||[]; order.chat.push({from: me.email, text: txt, at: new Date().toISOString()}); var idx = arr.findIndex(function(x){ return x.id===order.id; }); if(idx>-1){ arr[idx] = order; saveOrders(arr); renderMsgs(); qs('#replyMsg').value=''; } }); }

// sidebar/login/settings shared handlers
document.querySelectorAll('.box-control').forEach(function(el){ el.addEventListener('click', function(){
  var act = el.dataset.action;
  if(act==='toggle-sidebar'){ document.getElementById('sidebar').classList.toggle('-translate-x-full'); }
  if(act==='open-login'){ document.getElementById('loginModal').classList.remove('hidden'); document.getElementById('loginModal').classList.add('flex'); }
  if(act==='open-settings'){ document.getElementById('settingsModal').classList.remove('hidden'); document.getElementById('settingsModal').classList.add('flex'); }
})});
function closeLogin(){ document.getElementById('loginModal').classList.add('hidden'); document.getElementById('loginModal').classList.remove('flex'); }
function closeSettings(){ document.getElementById('settingsModal').classList.add('hidden'); document.getElementById('settingsModal').classList.remove('flex'); }
document.getElementById('loginForm').addEventListener('submit', function(e){ e.preventDefault(); var name=document.getElementById('loginName').value.trim(); var email=document.getElementById('loginEmail').value.trim(); localStorage.setItem('ravs_me', JSON.stringify({name: name, email: email})); alert('Login disimpan: '+name+' ('+email+')'); closeLogin(); });
document.getElementById('settingsForm').addEventListener('submit', function(e){ e.preventDefault(); var id=document.getElementById('delOrderId').value.trim(); var me = JSON.parse(localStorage.getItem('ravs_me')||'null'); if(!me || (me.email !== 'riorefan442@gmail.com' && me.email !== 'admin2@ravsstore.com')) return alert('Hanya admin yang bisa menghapus.'); var arr = JSON.parse(localStorage.getItem('ravs_orders')||'[]'); var idx = arr.findIndex(function(o){ return o.id === id; }); if(idx === -1) return alert('Order tidak ditemukan.'); arr.splice(idx,1); localStorage.setItem('ravs_orders', JSON.stringify(arr)); alert('Order dihapus: '+id); closeSettings(); });

// force delete button in admin page
document.getElementById('forceDeleteBtn').addEventListener('click', function(){
  var id = qs('#forceDeleteId').value.trim();
  var admin = JSON.parse(localStorage.getItem('ravs_me')||'null');
  if(!admin || (admin.email !== 'riorefan442@gmail.com' && admin.email !== 'admin2@ravsstore.com')) return alert('Login sebagai admin dulu (modal login di pojok kanan atas).');
  var arr = loadOrders();
  var idx = arr.findIndex(function(o){ return o.id === id; });
  if(idx === -1) return alert('Order tidak ditemukan');
  arr.splice(idx,1);
  saveOrders(arr);
  alert('Order terhapus: '+id);
  renderOrders();
});
</script>
</body>
</html>
